<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parameter Encoder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #C10C16;
            font-size: 24px;
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 15px;
        }

        label {
            width: 130px;
            margin-right: 10px;
            font-weight: bold;
            color: #555;
        }

        input,
        select {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            background-color: #fff;
            transition: border-color 0.3s ease;
        }

        input:focus,
        select:focus {
            border-color: #C10C16;
            outline: none;
        }

        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background-color: #C10C16;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #a10c14;
        }

        #result {
            margin-top: 30px;
            padding: 20px;
            background-color: #272822;
            color: #f8f8f2;
            border-radius: 5px;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: auto;
        }

        .copy-button {
            margin-top: 10px;
            background-color: #C10C16;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 14px;
            display: inline-block;
            transition: background-color 0.3s ease;
        }

        .copy-button:hover {
            background-color: #a10c14;
        }

        .add-key-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>Parameter Encoder</h1>

    <form id="encoderForm">
        <div class="form-row">
            <label for="env_select">Environment:</label>
            <select id="env_select">
                <option value="https://virtualagent-uat.nevo.ai/feedback/solution/">Staging</option>
                <option value="https://virtualagent.nevo.ai/feedback/solution/">Production</option>
            </select>
        </div>

        <div class="form-row">
            <label for="language">Language:</label>
            <select id="language">
                <option value="en">English</option>
                <option value="kr">Korean</option>
            </select>
        </div>

        <div class="form-row">
            <label for="ticket_id">Ticket ID:</label>
            <input type="text" id="ticket_id" value="LG-" required>
        </div>

        <div class="form-row">
            <label for="setup_type">Setup Type:</label>
            <select id="setup_type">
                <option value="Auto">Auto</option>
                <option value="Manual">Manual</option>
            </select>
        </div>

        <div class="form-row">
            <label for="device_type">Device Type:</label>
            <select id="device_type">
                <option value="Set-Top Box|셋톱박스">Set-Top Box</option>
                <option value="Blu-ray/DVD Player|블루레이/DVD 플레이어">Blu-ray/DVD Player</option>
                <option value="Home Theater|홈시어터">Home Theater</option>
                <option value="Sound Bar|사운드바">Sound Bar</option>
                <option value="OTT|OTT">OTT</option>
            </select>
        </div>

        <div class="form-row">
            <label for="device_brand">Device Brand:</label>
            <input type="text" id="device_brand" required>
        </div>

        <div class="form-row" id="input_type_row">
            <label for="input_type">Input Type:</label>
            <select id="input_type">
                <option value="HDMI">HDMI</option>
                <option value="Optical">Optical</option>
            </select>
        </div>

        <div id="key-values-container">
                  <div class="form-row" id="key_values_row">
                    <label for="key_val1">Key Value 1:</label>
                    <select id="key_val1">
                      <option value="">None</option>
                      <option value="CH+">CH+</option>
                      <option value="CH-">CH-</option>
                      <option value="Menu">Menu</option>
                      <option value="Vol+">Vol+</option>
                      <option value="Vol-">Vol-</option>
                      <option value="Mute">Mute</option>
                      <option value="Display">Display</option>
                      <option value="Info">Info</option>
                      <option value="custom">Custom</option>
                    </select>
                    <input type="text" id="custom_key_val1" style="display: none;">
                    <label for="key_work1" style="margin-left: 10px;">Works:</label>
                    <select id="key_work1">
                      <option value="Yes">Yes</option>
                      <option value="No">No</option>
                    </select>
                  </div>

                <div class="form-row" id="key_values_row2">
                    <label for="key_val2">Key Value 2:</label>
                    <select id="key_val2">
                        <option value="">None</option>
                        <option value="CH+">CH+</option>
                        <option value="CH-">CH-</option>
                        <option value="Menu">Menu</option>
                        <option value="Vol+">Vol+</option>
                        <option value="Vol-">Vol-</option>
                        <option value="Mute">Mute</option>
                        <option value="Display">Display</option>
                        <option value="Info">Info</option>
                        <option value="custom">Custom</option>
                    </select>
                    <input type="text" id="custom_key_val2" style="display: none;">
                    <label for="key_work2" style="margin-left: 10px;">Works:</label>
                    <select id="key_work2">
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>

                <div class="form-row" id="key_values_row3">
                    <label for="key_val3">Key Value 3:</label>
                    <select id="key_val3">
                        <option value="">None</option>
                        <option value="CH+">CH+</option>
                        <option value="CH-">CH-</option>
                        <option value="Menu">Menu</option>
                        <option value="Vol+">Vol+</option>
                        <option value="Vol-">Vol-</option>
                        <option value="Mute">Mute</option>
                        <option value="Display">Display</option>
                        <option value="Info">Info</option>
                        <option value="custom">Custom</option>
                    </select>
                    <input type="text" id="custom_key_val3" style="display: none;">
                    <label for="key_work3" style="margin-left: 10px;">Works:</label>
                    <select id="key_work3">
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <button type="button" id="add-key-button" class="add-key-button">+ Add Key</button>

           <button type="submit">Generate Encoded URL</button>
       </form>

    <div id="result"></div>

    <script>
        function utf8ToBase64URL(str) {
            const utf8Bytes = new TextEncoder().encode(str);
            let binaryString = '';
            utf8Bytes.forEach(byte => {
                binaryString += String.fromCharCode(byte);
            });
            return btoa(binaryString)
                .replace(/\+/g, '-')
                .replace(/\//g, '_')
                .replace(/=+$/, '');
        }

        let keyCount = 3;

        function setupCustomKeyListener(keyNum) {
            const selectElement = document.getElementById(`key_val${keyNum}`);
            const customInputElement = document.getElementById(`custom_key_val${keyNum}`);

            selectElement.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customInputElement.style.display = 'inline-block';
                } else {
                    customInputElement.style.display = 'none';
                }
            });
        }

        // Setup listeners for initial key values
        for (let i = 1; i <= 3; i++) {
            setupCustomKeyListener(i);
        }

        document.getElementById('add-key-button').addEventListener('click', function() {
            if (keyCount < 8) {
                keyCount++;
                const newKeyRow = document.createElement('div');
                newKeyRow.className = 'form-row';
                newKeyRow.id = `key_values_row${keyCount}`;
                newKeyRow.innerHTML = `
                    <label for="key_val${keyCount}">Key Value ${keyCount}:</label>
                    <select id="key_val${keyCount}">
                        <option value="">None</option>
                        <option value="CH+">CH+</option>
                        <option value="CH-">CH-</option>
                        <option value="Menu">Menu</option>
                        <option value="Vol+">Vol+</option>
                        <option value="Vol-">Vol-</option>
                        <option value="Mute">Mute</option>
                        <option value="Display">Display</option>
                        <option value="Info">Info</option>
                        <option value="custom">Custom</option>
                    </select>
                    <input type="text" id="custom_key_val${keyCount}" style="display: none;">
                    <label for="key_work${keyCount}" style="margin-left: 10px;">Works:</label>
                    <select id="key_work${keyCount}">
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                `;

                // Insert the new row after the last key_values_row
                const lastKeyRow = document.getElementById(`key_values_row${keyCount - 1}`);
                lastKeyRow.parentNode.insertBefore(newKeyRow, lastKeyRow.nextSibling);

                // Setup listener for the new key value
                setupCustomKeyListener(keyCount);

                if (keyCount === 8) {
                    document.getElementById('add-key-button').style.display = 'none';
                }
            }
        });

        document.getElementById('encoderForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const envUrl = document.getElementById('env_select').value;
            const language = document.getElementById('language').value;
            const ticket_id = document.getElementById('ticket_id').value;
            const setup_type = document.getElementById('setup_type').value;
            const device_type = document.getElementById('device_type').value.split('|');
            const deviceType = language === 'kr' ? device_type[1] : device_type[0];
            const dtLocale = language === 'kr' ? device_type[1] : device_type[0];
            const device_brand = document.getElementById('device_brand').value;

            let resultObject = {
                Ticket: ticket_id,
                SetupType: setup_type,
                DeviceType: deviceType,
                DtLocale: dtLocale,
                Brand: device_brand
            };

            if (setup_type === 'Manual') {
                resultObject.InputType = document.getElementById('input_type').value;

                resultObject.Keys = [];
                for (let i = 1; i <= keyCount; i++) {
                    const keyValElement = document.getElementById(`key_val${i}`);
                    const keyVal = keyValElement.value;
                    const keyWorks = document.getElementById(`key_work${i}`).value;
                    if (keyVal !== '') {
                        resultObject.Keys.push({
                            Key: keyVal === 'custom' ? document.getElementById(`custom_key_val${i}`).value : keyVal,
                            KeyWorks: keyWorks
                        });
                    }
                }
            } else if (setup_type === 'Auto') {
                resultObject.InputType = 'HDMI';
            }

            const resultJSON = JSON.stringify(resultObject);
            const base64URLEncodedJSON = utf8ToBase64URL(resultJSON);
            const finalURL = `${envUrl}${base64URLEncodedJSON}`;

            document.getElementById('result').innerHTML = `
                <h2>Results:</h2>
                <div><strong>JSON Object:</strong></div>
                <pre><code id="jsonResult">${resultJSON}</code></pre>
                <div><strong>Base64URL Encoded JSON:</strong></div>
                <pre><code>${base64URLEncodedJSON}</code></pre>
                <button class="copy-button" onclick="copyToClipboard('${finalURL}')">Copy URL</button>
            `;
        });

        document.getElementById('setup_type').addEventListener('change', function () {
            const setupType = document.getElementById('setup_type').value;
            if (setupType === 'Auto') {
                document.getElementById('input_type_row').style.display = 'none';
                document.getElementById('key-values-container').style.display = 'none';
                document.getElementById('add-key-button').style.display = 'none';
            } else {
                document.getElementById('input_type_row').style.display = 'flex';
                document.getElementById('key-values-container').style.display = 'block';
                document.getElementById('add-key-button').style.display = 'inline-block';
            }
        });

        async function copyToClipboard(url) {
            try {
                await navigator.clipboard.writeText(url);
                displayMessage('URL copied successfully');
            } catch (err) {
                displayMessage('Failed to copy URL');
            }
        }

        function displayMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.textContent = message;
            messageDiv.style.position = 'fixed';
            messageDiv.style.bottom = '20px';
            messageDiv.style.left = '50%';
            messageDiv.style.transform = 'translateX(-50%)';
            messageDiv.style.backgroundColor = '#676767';
            messageDiv.style.color = '#fff';
            messageDiv.style.padding = '10px 20px';
            messageDiv.style.borderRadius = '5px';
            messageDiv.style.fontSize = '16px';
            messageDiv.style.zIndex = '1000';
            document.body.appendChild(messageDiv);

            setTimeout(() => {
                document.body.removeChild(messageDiv);
            }, 3500);
        }
    </script>

</body>

</html>
